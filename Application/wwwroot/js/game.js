(()=>{"use strict";function e(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var n=function n(t,i){var o=this;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),e(this,"name",void 0),e(this,"colourName",void 0),e(this,"CalculateMoves",(function(){})),e(this,"Move",(function(e,n,t){var i=o.CalculateMoves(e,t);return o.ReturnBehavior(n,i)})),e(this,"ReturnBehavior",(function(e,n){for(var t=-2,i=0;i<n.movements.length;i++){var o=n.movements[i],r=n.capturing[i];if(o==e){t=r>0?r:0;break}}return t})),this.colourName=t,this.name=i};function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,n){return(i=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function o(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?r(e):n}function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var c=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&i(e,n)}(s,e);var n,t,c=(n=s,t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=a(n);if(t){var r=a(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return o(this,e)});function s(e,n){var t,i,o,a;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,s),a=function(e,n){for(var t=0,i=[-9,-7,7,9],o={movements:[],capturing:[]},r=0;r<8;r++){var a=r%4;r%4==0&&t++;var c=e+i[a]*t;if(c<=63&&c>=0&&null==n.fields[c].pawn){var s=e+i[a]*(t-1);if(null!=n.fields[s].pawn&&n.fields[s].pawn.colourName!=n.fields[e].pawn.colourName&&e!=s&&t>1||1==t){if("White"==n.fields[e].pawn.colourName&&1==t&&i[a]>0||"Black"==n.fields[e].pawn.colourName&&1==t&&i[a]<0)continue;o.movements.push(c),t>1?o.capturing.push(s):o.capturing.push(0)}}}return o},(o="CalculateMoves")in(i=r(t=c.call(this,e,n)))?Object.defineProperty(i,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[o]=a,t}return s}(n);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,n){return(l=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function u(e,n){return!n||"object"!==s(n)&&"function"!=typeof n?f(e):n}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&l(e,n)}(o,e);var n,t,i=(n=o,t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=d(n);if(t){var o=d(this).constructor;e=Reflect.construct(i,arguments,o)}else e=i.apply(this,arguments);return u(this,e)});function o(e,n){var t,r,a,c;return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,o),c=function(e,n){for(var t=0,i=[-9,-7,7,9],o={movements:[],capturing:[]},r=0;r<28;r++){var a=r%4;if(r%4==0&&t++,0!=i[a]){var c=e+i[a]*t;if(c<=63&&c>=0&&null==n.fields[c].pawn&&n.fields[c].index%2==1){var s=t-1,l=e+i[a]*s,u=e+i[a]*--s;if(null!=n.fields[l]&&null!=n.fields[l].pawn&&null!=n.fields[u]&&null!=n.fields[u].pawn&&e!=l&&e!=u){i[a]=0;continue}if(null!=n.fields[l].pawn&&e!=l&&(i[a]=0),null!=n.fields[l].pawn&&n.fields[l].pawn.colourName==n.fields[e].pawn.colourName&&e!=l)continue;o.movements.push(c),t>1&&null!=n.fields[l].pawn?o.capturing.push(l):o.capturing.push(0)}}}return o},(a="CalculateMoves")in(r=f(t=i.call(this,e,n)))?Object.defineProperty(r,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[a]=c,t}return o}(n);function h(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function v(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var w=function e(n,t,i,o,r,a,c,s){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]&&arguments[9];h(this,e),v(this,"x",void 0),v(this,"y",void 0),v(this,"begin_x",void 0),v(this,"begin_y",void 0),v(this,"center_x",void 0),v(this,"center_y",void 0),v(this,"colour",void 0),v(this,"index",void 0),v(this,"pawn",void 0),v(this,"isMarked",void 0),this.x=n,this.y=t,this.center_x=i,this.center_y=o,this.colour=r,this.index=s,this.begin_x=a,this.begin_y=c,this.pawn=l,this.isMarked=u};function y(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var m=function e(n){var t=this;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),y(this,"fields",[]),y(this,"canvas",void 0),y(this,"SetFields",(function(){for(var e=0;e<8;e++)for(var n=0;n<8;n++)(e+n+8*e)%2==0?t.fields.push(new w(n,e,50*n+25,50*e+25,"Light",50*n,50*e,e+n+8*e)):e+n+8*e<=25?t.fields.push(new w(n,e,50*n+25,50*e+25,"Dark",50*n,50*e,e+n+8*e,new c("Black","Pawn"))):e+n+8*e>=45?t.fields.push(new w(n,e,50*n+25,50*e+25,"Dark",50*n,50*e,e+n+8*e,new c("White","Pawn"))):t.fields.push(new w(n,e,50*n+25,50*e+25,"Dark",50*n,50*e,e+n+8*e))})),y(this,"DrawBoard",(function(){for(var e=0;e<64;e++)"Light"==t.fields[e].colour?(t.canvas.fillStyle="rgb(197, 161, 77)",t.canvas.fillRect(t.fields[e].begin_x,t.fields[e].begin_y,50,50)):(t.canvas.fillStyle="rgb(97, 53, 28)",t.canvas.fillRect(t.fields[e].begin_x,t.fields[e].begin_y,50,50))})),y(this,"DrawPawns",(function(){for(var e=0;e<64;e++)null!=t.fields[e].pawn&&t.DrawPawn(e)})),y(this,"DrawPawn",(function(e){t.canvas.beginPath(),t.canvas.arc(t.fields[e].center_x,t.fields[e].center_y,20,0,2*Math.PI),"Pawn"==t.fields[e].pawn.name&&("White"==t.fields[e].pawn.colourName?t.canvas.fillStyle="rgb(255,255,255)":t.canvas.fillStyle="rgb(0,0,0)"),"Queen"==t.fields[e].pawn.name&&("White"==t.fields[e].pawn.colourName?t.canvas.fillStyle="rgb(212,175,55)":t.canvas.fillStyle="rgb(192,192,192)"),t.canvas.fill(),t.canvas.closePath()})),y(this,"ReturnIndexOnBoard",(function(e,n){var t=e.getBoundingClientRect();return Math.floor((n.clientX-t.left)/50)+8*Math.floor((n.clientY-t.top)/50)})),y(this,"SelectPawn",(function(e,n,i){return null==t.fields[e].pawn||t.fields[e].pawn.colourName!=i?n:(t.fields[e].pawn,t.UnmarkPawn(),t.canvas.beginPath(),t.canvas.arc(t.fields[e].center_x,t.fields[e].center_y,20,0,2*Math.PI),"Pawn"==t.fields[e].pawn.name?t.canvas.fillStyle="rgb(0,255,0)":t.canvas.fillStyle="rgb(13, 161, 229)",t.canvas.fill(),t.canvas.closePath(),t.fields[e].isMarked=!0,e)})),y(this,"UnmarkPawn",(function(){for(var e=0;e<64;e++)if(null!=t.fields[e].pawn&&t.fields[e].isMarked){t.DrawPawn(e),t.fields[e].isMarked=!1;break}})),y(this,"Move",(function(e,n){var i=t.fields[e].pawn.Move(e,n,t);return-2!=i&&(t.fields[n].pawn=null,t.fields[n].pawn=t.fields[e].pawn,t.fields[e].pawn=null,0!=i&&(t.fields[i].pawn=null),t.ChangeToQueen(n,e),t.DrawBoard(),t.DrawPawns(),!0)})),y(this,"ChangeToQueen",(function(e){(0==t.fields[e].y&&"White"==t.fields[e].pawn.colourName||7==t.fields[e].y&&"Black"==t.fields[e].pawn.colourName)&&(t.fields[e].pawn=new p(t.fields[e].pawn.colourName,"Queen"))})),this.SetFields(),this.canvas=n.getContext("2d")},b=document.getElementById("Board"),g=document.querySelector("textarea"),k=document.querySelector(".possition1-btn"),P=document.querySelector(".possition2-btn"),S=document.querySelector(".score-box"),N=document.querySelector(".close-info"),O=document.querySelector("#back-link"),_=document.getElementById("text"),x=document.getElementById("messageButton"),B=new WebSocket("wss://localhost:44354/Game/Room?name=".concat(room)),R={},M={},D="White",E=new m(b);E.DrawBoard(),E.DrawPawns();var j=-1;b.addEventListener("click",(function(e){if((k.value==nick||P.value==nick)&&D==M[nick]&&"1#"!=k.value&&"2#"!=P.value){var n=E.ReturnIndexOnBoard(b,e);if((j=E.SelectPawn(n,j,M[nick]))!=n&&-1!=j&&null==E.fields[n].pawn&&1==E.Move(j,n)){r=M[nick],D="White"==r?"Black":"White",R.type="Board",R.index=n,R.prevIndex=j,R.whoseTurn=D,R.userName=nick,R.colour=M[nick];var t=(i=0,o=0,E.fields.forEach((function(e){null!=e.pawn&&("White"==e.pawn.colourName&&i++,"Black"==e.pawn.colourName&&o++)})),[i,o]);R.white=t[0],R.black=t[1],j=-1,B.send(JSON.stringify(R))}}var i,o,r})),k.addEventListener("click",(function(e){k.value!=nick&&P.value!=nick&&"1#"==k.value&&(R.type="Position1",R.userName=nick,R.position="Position1",M[nick]="White",B.send(JSON.stringify(R)))})),P.addEventListener("click",(function(e){k.value!=nick&&P.value!=nick&&"2#"==P.value&&(R.type="Position2",R.userName=nick,R.position="Position2",M[nick]="Black",B.send(JSON.stringify(R)))})),O.addEventListener("click",(function(e){R.type="Leave",R.userName=nick,R.colour=M[nick],R.position="White"==M[nick]?"Position1":"Position2",B.send(JSON.stringify(R)),window.location.href=O.getAttribute("href")})),x.addEventListener("click",(function(e){null!=_.value&&(R.type="Message",R.message=_.value,R.userName=nick,_.value="",B.send(JSON.stringify(R)))})),N.addEventListener("click",(function(e){b.classList.remove("hide"),S.classList.remove("show")})),B.onopen=function(e){R.type="Join",R.userName=nick,R.connection="",g.disabled=!0,B.send(JSON.stringify(R))},B.onmessage=function(e){var n,t,i=JSON.parse(e.data);switch(i.type){case"Join":g.value+="Dołączył: ".concat(i.userName," \n"),i.userName==nick&&O.setAttribute("href","Room?name=".concat(room,"&connection=").concat(i.connection));break;case"Position1":case"Position2":n=i.position,t=i.userName,"Position1"==n&&(k.value=t,k.disabled=!0),"Position2"==n&&(P.value=t,P.disabled=!0);break;case"Message":g.value+="".concat(i.userName,": ").concat(i.message," \n");break;case"Board":if(i.userName!=nick&&(E.Move(i.prevIndex,i.index),D=i.whoseTurn),0==i.white||0==i.black){b.classList.add("hide"),S.classList.add("show");var o="White"==i.colour?i.white:i.black;S.children[1].innerText="Wygrał "+i.userName,S.children[2].innerText="Kolor "+i.colour,S.children[3].innerText="Pozostało pionków  "+o}break;case"Leave":!function(e){"Position1"==e&&(k.disabled=!1,k.value="1#"),"Position2"==e&&(P.disabled=!1,P.value="2#")}(i.position),g.value+="Opuścił: ".concat(i.userName,"\n"),(E=new m(b)).DrawBoard(),E.DrawPawns(),D="White"}}})();